
## 0_정리 
``` bash 
- 실행컨텍스트는 자바스크립트 엔진이 소스코드를 '평가' 하고 '실행' 하기 위해 필요한 '환경'을 제공하고, 코드의 '실행결과'를 실제로 관리하는 영역이다.  (출처 : 모던 자바스크립트 p41)

```


<br>


## 1. 소스 코드의 타입 
``` bash 
- 소스코드의 종류에는 '전역 코드', '함수 코드', 'eval 코드', '모듈 코드' 가 있음. 

- 소스코드의 종류를 구분하는 이유는 (출처 : 모던 자바스크립트 p364)
	- 소스 코드 종류에 따라서 -> 코드를 관리하는 '실행 컨텍스트' 의 생성과 관리방식이 달라지기 때문. 
	- 즉, 소스 코드가 제대로 동작 하려면 
		1) 소스 코드 안에 있는 '식별자' 와 '식별자에 바인딩 된 값의 변화' 에 대해서  '⭐등록, 상태 변화, 스코프 체인을 통한 식별자 검색⭐' 을 통해 관리된다. -> 이렇게 되면, 적시에, 메모리 안에 있는 데이터 및 명령어를 CRUD 할 수 있다.
		2) 소스 코드 안에서의 '실행 흐름' 이 관리 되어야 한다. 왜냐면, 예를 들어서, 함수 실행의 경우, 함수 내부로 제어권이 이동했다가, 원래의 위치로 다시 돌아와야 하기 때문이다.  JS 는 이 실행흐름을 '⭐스택⭐' 을 통해 관리한다. 
		3) 위의 관리 항목은 해당 소스코드가 어떠한 유형인가! 에 따라서 '구체적인 관리 방식이 달라' 지게 된다. 
			ex) 전역 코드에서, 키워드별로 -> 해당 변수가 등록되는 곳이 달라짐. 

- 그러면, '전역 코드', '함수 코드' 안에서는, 어떻게 관리되는가. (관리 대상 : 식별자, 식별자 바인딩된 값, 실행 흐름 등)
- 소스코드는, '평가와 실행' 을 통해 관리 된다. 
- 그러면, '평가' 와 '실행' 의 과정에서는, 각각 어떠한 일이 일어나고 있는가! 를 알아야 한다. 
```


<br>

## 2. 소스코드의 평가와 실행
``` bash 
- 모든 소스코드는 '평가' 를 거친다. 

- 평가에 따라서, 
	- 예를 들면, 변수 선언시 키워드가 var 가 사용된 경우에는 -> '식별자 등록'은 '전역 렉시컬 환경'에서 '객체 환경 레코드' 에 등록되어 관리 된다. 
	- 예를 들면, 변수 선언시 키워드 let, const 가 사용된 경우에는 -> '식별자 등록'은 '전역 렉시컬 환경'에서 '선언적 환경 레코드' 에 등록되어 관리 된다. 

- 이렇게, '소스코드의 내용에 따라서 -> 관리되는 양상이 결정'되고 -> 이에 기반하여, '실행' 이루어짐. 

- 그러면, 아래의 코드가, 구체적으로 어떻게 '평가와 실행' 의 과정을 거치는지 알아보자. 
```


- 예시 코드 
``` js
// 전역 변수 선언
var x = 1;
const y = 2; 

// 함수 정의 
function foo(a) {
	// 지역 변수 선언
	var x = 3;
	const y = 4;

	function bar (b) {
		const z = 5;
		console.log(a + b + x + y + z);
	}
	bar(10)
}

// 함수 호출 
foo(20);  // 42
```

<br>

### 1) 전역 객체 생성 
``` js 
0. 전역 객체 생성 (출처 : 모던 자바스크립트 P368)
	- '동작 환경' 에 따라, '클라이언트 사이드' 에서는 'window', '서버 사이드' 에서는 'global' 객체가 생성됨. 
		- 클라이언트 사이드에서는 'Web API(DOM, BOM, SVG, fetch, XMLHttpRequest 등)'  
	- 전역객체에는 
		- 전역 빌트인 프로퍼티, 전역 빌트인 함수, 전역 빌트인 객체, 가 포함된다. 
```

- 추가 학습 : '전역 객체의 역할' 에 대해서, 이론적으로 궁금


<br>


### 2) 전역 코드 평가 
``` bash
- 모던 자바스크립트 p369 의 그림 구조와 동일
- js 소스코드가 로드되면, 'js 엔진' 이 소스코드를 '평가' 한다. 

1. 전역 실행 컨텍스트 생성
	- '전역 객체 생성' 이 전제 되어야 함
	- 생성된 실행 컨텍스트는, 스택(stack) 자료구조로 관리된다. (출처 : 모던 자바스크립트 p365)
	- '전역 실행 컨텍스트' 생성 -> 스택에 'push' -> '실행 중' 인 전역 컨텍스트 가 된다. 
		- 왜냐면, '스택의 최상단은, 현재 실행 중인 코드의 컨텍스트' 이기 때문에 (출처 : 모던 자바스크립트 p366)
	- '실행 컨텍스트의 구성' 
		- 실행 컨텍스트는 '렉시컬 환경' 으로 구성되어 있다. (출처 : 모던 자바스크립트 p367 그림)
		- '렉시컬 환경' 은 1) '환경 레코드' 2) this 바인딩 3) '외부 렉시컬 환경에 대한 참조' 로 구성되어 있다. (출처 : 모던 자바스크립트 p367 그림)


2. 전역 렉시컬 환경 생성 

	2.1 전역 환경 레코드 생성 = '식별자 등록 + 식별자에 초기값 바인딩'
		- 흔히, '평가' 라고 하는 부분이 레코드 생성을 의미했던 것 같음. 
		- '렉시컬 환경 자체' 를 '스코프(scope)' 라고 불렀음 ⭐⭐⭐⭐⭐(출처 : 모던 자바스크립트 p367 , 스코프 부분을 공부하면, 나옴.)
		- '선언 단계' 와 '초기화 단계' 를 거쳐서, 환경 레코드에 식별자와 식별자에 바인딩된 값이 기록된다. 
			- '선언 단계'
				- '선언문' 만! 먼저 실행한다. 
				- name binding, '변수 이름' 과 '메모리 주소' 를 바인딩, 식별자 등록
			- '초기화 단계' : 식별자에 바인딩 될 초기값을 설정. 
				- 변수의 경우
					- var 키워드의 초기화 
						- '선언' 과 '초기화 단계' 가 '함께' 진행 
						- 'undefined' (데이터 타입 중 원시형). -> 호이스팅 발생시, undefined 값 출력, 오류 발생하지 않음. 
					- let, const 키워드의 초기화
						- 선언(식별자 등록)과 초기화가 '분리' 되어 진행 
						- 초기화는 '실행' 단게에서 진행됨. 
						- 그래서, 평가 단계에서 '<uninitialized>' 가 등록 -> TDZ(일시적 사각 지대) 발생 -> 호이스팅 발생시, 참조 에러(reference error) 발생 원인 
				- 함수 선언문의 경우 -> '함수 객체' 가 등록 된다. -> 호이스팅 발생시, 함수 실행 가능 ⭐⭐⭐⭐⭐ (선언과 함께, 초기화(값 바인딩 되는 것) 이 진행되어서 실행이 가능)
			- '선언 -> 초기화' 까지 마무리 되면, '평가' 가 완료되었다고 함. (정확히는, 환경 레코드 생성이 마무리. '평가' 의 개념을 광의로 본다면, 이 과정은 환경 레코드 생성 마무리에 불과함.)

		2.1.1 객체 환경 레코드 생성 : 'var' 키워드 및 함수 선언문
			- '함수 선언문' 으로 정의한 전역 함수 ⭐⭐ 
			- 'var 키워드' 로 변수를 선언한 경우
				- 스코프 : 함수 레벨 스코프 ⭐⭐⭐⭐⭐ 
			- '선언 단계(name binding)' 와 '초기화 단계' 를 ⭐'동시'⭐ 에 진행 
				- 선언 단계 : 선언문만! 실행 -> 식별자 등록
				- 초기화 단계
					- var 키워드의 초기화 : 'undefined' (데이터 타입 중 원시형). -> 호이스팅 발생시, undefined 값 출력, 오류 발생하지 않음. 
					- 함수 선언문의 경우 -> '함수 객체' 가 등록 된다. -> 호이스팅 발생시, 함수 실행 가능 ⭐⭐⭐⭐⭐
			

		2.1.2 선언적 환경 레코드 생성 : 'let, const'
			- 'let, const' 키워드로 변수를 선언한 경우
				- 스코프 : 블록 레벨 스코프 ⭐⭐⭐⭐⭐ 
			- '선언 단계(name binding)' 와 '초기화 단계' 를 '⭐분리⭐' 해서 진행
				- 선언 단계 : 선언문만! 실행 -> 식별자 등록
				- 초기화 단계 
					- 값을 넣지 않는다. -> '<uninitialized>' 이 찍힌다. -> 일시적 사각지대, TDZ(temporarily dead zone) 발생 -> 호이스팅 발생시 reference error 발생 하게 된다. 


	2.2 this 바인딩
		- 추가 공부 필요 📛📛📛 


	2.3 외부 렉시컬 환경에 대한 참조 결정 
		- 상위 스코프로 연결 
		- 전역 렉시컬 환경은 '스코프 체인'의 '종점' 이므로 'null' 이 할당


- 출처 : 모던 자바스크립트 p369
```

- 보충 학습 
	- this 에 대해서 추가 학습 해야 함 ⭐



- let, const 키워드를 사용한 '선언적 환경 레코드' 에서 평가 과정 예시 (출처 : 모던 자바스크립트 p373)
``` js 
// 에러 없음 
let foo = 1; 

	{
		console.log(foo)
	}

/* 실행 순서 
	1. 전역 코드 평가 
		- foo 선언 : foo 식별자 등록
		- 초기값 : let 키워드 이므로, 초기값 없음
		- 스코프는 블록 레벨 스코프 적용 -> so, { } 안에는 영향 미치지 않음 ⭐⭐⭐ 
	3. 전역 코드 실행 
		- [할당] foo 에 1 할당
		- 블록 코드 만남 -> 제어권이 블록 코드로 이동 
	4. 블록 코드 평가
		- 선언문 등록 : 아직, 등록할 것이 없음 
	5. 블록 코드 실행
		- console 실행 -> foo 참조 해야 함 
			- { } 안에 없음 -> 상위 스코프에서 검색 -> 참조하여 실행
*/
```


``` js
// 에러 있음
let foo = 1; 

	{
		console.log(foo)
		let foo = 2;
	}

/* 실행 순서 
	1. 전역 코드 평가 
		1) [선언문 실행 및 식별자 등록 하기] 
			- foo 선언 : foo 식별자 등록
			- 초기값 : let 키워드 이므로 초기값 없음 
			- 스코프는 블록 레벨 스코프 => { } 안에는 영향 없음 ⭐⭐⭐ 
	1. 전역 코드 실행 
		1) [할당하기] foo 에 1 할당하기 
		2) 블록 코드 만남 -> 블록 코드로 제어권 이동 (맞나❓ -> 응 맞아 )
	2. 블록 코드 평가
		1) [선언문 실행 및 식별자 등록] 
			- foo 선언 : foo 식별자 등록
			- 초기값 :  let 키워드 이므로,  초기값 없음! -> TDZ 상태
	3. 블록 코드 실행
		1) console.log 실행 
			- 전역 객체 찾기 
			- foo '참조' 
				- foo 참조할 값 없음 -> referece error 발생 ⭐⭐⭐⭐⭐ 
*/
```


<br>

### 3) 전역 코드 실행
``` js
// 1. 할당(대입 연산자) 실행 
	// 1) 해당 식별자가 '선언된 식별자 인지' 확인 , '식별자 검색' (환경 record 에 등록된 건지 확인)
		// [스코프 체인 활용, 검색] 해당 환경 record 에 없다면 -> ⭐스코프체인⭐을 따라서, 상위 스코프의 환경 record 에 선언되어 있는지 탐색 한다. 
		// [식별자 결정] '동일한 이름의 식별자' 가, '다른 스코프' 에도 존재할 수 있다. '어떤 스코프의 식별자를 참조할지 결정' 하는 문제가 '식별자 결정(identifier resolution)' 이라고 한다. ⭐⭐⭐⭐⭐ 
	// 2) 식별자 탐색 완료 -> 해당 식별자에 1을 바인딩 한다. (할당을 한다.)
var x = 1;

const y = 2; 

// 2. foo 함수 호출 -> 전역 코드 실행 일시 중지 -> ⭐제어권⭐이 foo 함수 안으로 이동 -> foo 함수 코드 평가 (출처 : 모던 자바스크립트 p376)
foo(20);
```


<br>

### 4) foo 함수 코드 평가 
``` bash
1. 'foo 함수 실행 컨텍스트' 생성 -> stack 에 push -> '최상위 실행 컨텍스트 = foo 함수 실행 컨텍스트' 이므로, 'foo 함수 실행 컨텍스트' 는 '실행 중인 실행 컨텍스트' 가 된다. 
	- '함수 실행 컨텍스트' 는 '함수 렉시컬 환경' 으로 구성된다. 
	- '함수 렉시컬 환경' 은 '함수 환경 레코드' , 'this 바인딩' , '외부 렉시컬 환경에 대한 참조 결정' 으로 구성된다. 

2. 함수 렉시컬 환경 생성 
	2.1 함수 환경 레코드 생성 (출처 : 모던 자바스크립트 p377)
		- '평가' = '선언(name binding, 식별자 이름과 메모리 주소 연결)' + '초기화(키워드에 따른 초기값 설정)'
		- 스코프 : 키워드에 따라서 다른 스코프가 형성됨 ⭐⭐
		- 매개변수
			- 선언 : a 식별자 등록 
			- 초기화 : undefined 로 등록 (✅ var 키워드와 동일)
		- arguments : 추후 공부 📛📛
		- x 
			- 선언 : a 등록 
			- 초기화 : 키워드 var 이므로 -> undefined 값이 바인딩
			- 스코프 : var 이므로 -> 함수 레벨 스코프 (함수에서의 블록만 유효 스코프로 인정) 📛📛
		- y 
			- 선언 : y 등록 
			- 초기화 : 키워드 const 이므로 -> <uninitialized> 으로 표시. 바인딩 되는 값은 없음 
			- 스코프 : const 이므로 -> 블록 레벨 스코프 (if, while 등 의 블록 도 유효 스코프로 인정) 📛📛
		- bar 
			- 선언 : bar 등록
			- 초기화 : ⭐함수 선언문⭐ 이므로 -> '<function object>' ⭐⭐곧바로, 등록 ⭐⭐⭐ 
			
	2.2 this 바인딩 
		- 함수 호출 방식에 따라 결정 (출처 : 모던 자바스크립트 p377)
		- 아직, 명확히는 모르겠음 😥😥😥 

	2.3 외부 렉시컬 환경에 대한 참조 결정 
		- '평가 시점' 을 중심으로 상위 스코프를 연결 한다. ⭐⭐⭐⭐⭐ 
			- js 는 함수를 '어디서 호출' 했는지가 아니라, '어디서 정의' 했는가에 따라 '상위 스코프를 결정' 한다. (출처 : 모던 자바스크립트 379p)
		- 현재, 'foo 함수의 실행컨텍스트의 렉시컬 환경' 에 있으므로, 상위 스코프는 '전역 렉시컬 환경⭐' 이 된다. (출처 : 모던 자바스크립트 p378, p379) (📛📛 용어가 불확실)
```

<br>

### 5) foo 함수 코드 실행 
``` js 
// 1. 대입 연산자를 활용한 '할당'
	// 1) 식별자 결정 
		// a) 해당 식별자가, '현재 실행중인 컨텍스트' 의 '환경 레코드' 에 등록되었는지, '식별자 검색'
		// b) 검색되지 않으면 -> '외부 참조' 가 가리키는 '상위 스코프'로 이동하여, 식별자 검색 
		// c) 검색 완료 되면 -> '검색된 식별자'에 '값을 바인딩⭐⭐⭐' 한다.  (바인딩 한다는 표현⭐⭐) (출처 : 모던 자바스크립트 p380)
	var x = 3;  // x 는 현재 환경 레코드에 등록되어 있는 상태
	const y = 4;  // x 는 현재 환경 레코드에 등록되어 있는 상태

// 2. bar 함수 정의 는 -> 앞선 평가과정에서 등록해놓음 

// 3. bar 함수 실행 
	// 1) 제어권이 bar 함수로 이동 -> bar 함수를 평가 
```



<br>


### 6) bar 함수 평가
``` bash 
- 출처 : 모던 자바스크립트 p381

1. bar 함수 실행 컨텍스트 생성 -> stack 에 push -> '스택의 최상위 실행 컨텍스트 = bar 함수 실행 컨텍스트' 이므로,  'bar 함수 실행 컨텍스트' 가 실행 된다. 
	- '실행 컨텍스트' = '렉시컬 환경'으로 구성 
	- '렉시컬 환경' = '환경 레코드', 'this 바인딩', '외부 렉시컬 환경에 대한 참조 결정' 으로 구성

2. bar 함수 렉시컬 환경 생성
	2.1 함수 환경 레코드 생성
		- '평가' = '선언(name binding, 식별자 이름과 메모리 주소를 연결)' + '초기화(키워드에 따른 초기값 설정)'
		- 스코프 : 키워드에 따라서, 개별적인 유효 스코프가 생성됨
		- z
			- 선언 : z 등록 
			- 초기화 : 키워드 const 이므로 -> 바인딩 되는 값은 없음. 
			- 스코프 : 키워드 가 const 이므로 -> 블록레벨스코프 -> if, for 과 같은 블록도 유효 스코프 계산시 반영해야 함. ({ } 이거를 뚫고 영향을 미치지 못 함) 
	2.2 this 바인딩
			- 추가 학습 필요 📛📛📛
	2.3 외부 렉시컬 환경에 대한 참조 결정
			- '함수를 어디에서 호출' 했는지가 아니라 '어디에서 정의' 되었는지에 따라, '상위 스코프' 가 결정 (출처 : 모던 자바 스크립트 p379)
			- '현재 렉시컬 환경은', 'bar 함수 렉시컬 환경' 임 -> 따라서, 상위 스코프는 'foo 함수 렉시컬 환경'이 됨. 

👉 평가가 끝났으므로 바로 실행 
```
- 📛 애매한게 
	- '평가 = record + this 바인딩 + 외부 참조 결정' 까지 인지, 아니면, 협소하게, 평가 = 선언 + 초기화! 만 인지!
		- 교재 상으로는 전자가 맞는듯. 그래서, 평가를 한다면, 실행에 필요한 정보를 모두 받아오는 느낌. 
	- 평가 단계에서 스코프도 결정이 되나? ❓❓❓❓❓  
		- 그런 것 같기는 한데, 스코프가 환경 레코드 이지 않나
		- 이건, '렉시컬 스코프' 과 관련 있는 것 같기도 하고 (출처 : 모던 자바스크립트 p390)

<br>

### 6) bar 함수 실행 
``` js 
// 1. z 식별자에 5 값 할당
	// 1) 식별자 검색 
		// a) '해당 식별자' 가 '현재 실행 컨텍스트'의 '환경 레코드' 에 등록되어 있는지 '검색'
		// b) 없다면 -> '외부 참조' 를 통해 '상위 스코프' 도 검색
		// c) 있다면 -> 검색된 식별자에, 값을 ⭐바인딩⭐ 한다. (출처 : 모던 자바스크립트 p380)
const z = 5 

// 2. console 실행 
	// 스코프 체인 검색을 통해 -> 전역 렉시컬 환경에서 찾는다. 
	// log 는 console 객체가 소유하는 프로퍼티 임. 

// 3. a, b, y, z 호출 ⭐⭐⭐⭐⭐ (이게 잘 되어야 함) (출처 : 모던 자바스크립트, p383)
	// 식별자 검색 과정 
		// 1) '해당 식별자' 가 '현재 실행 컨텍스트' 의 '환경 레코드' 에 있는지 검색 
		// 2) 없다면 -> '외부 참조' 를 통해 '상위 스코프' 검색 
		// 3) 있다면, -> 검색된 식별자에 바인딩된 값을 참조! 

	// a : foo 함수의 매개변수 이므로 -> '⭐⭐스코프 체인' 을 따라서 -> foo 함수 렉시컬 환경 에서 검색됨 
	// b : bar 함수의 매개변수 -> bar 함수의 렉시컬 환경에서 검색됨 
	//  x,y : 해당 스코프에 없으므로 -> 상위 스코프로 이동해서 foo 함수의 렉시컬 환경에서 검색됨  (이 부분이 헷갈림😥😥😥😥😥)

// 👉 그 다음, 실행할 코드가 없음 -> 'bar 함수 실행 컨텍스트'가 '스택에서 제거' (제어권 이동하여, 원래 코드로 복귀)
// 👉 그 다음, 'foo 함수 실행 컨텍스트' 로 '제어권 이동' 해서, '실행 중인 실행 컨텍스트' 가 됨 (제어권 이동하여, 원래 코드로 복귀)⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐ (참조 : 모던 자바스크립트 p384)

// 만약, 누군가가, 'bar 렉시컬 환경을 참조' 하고 있다면 -> 가비지 컬렉터가 제거하지는 않음. -> 이로 인해, 클로저가 가능해짐 ⭐⭐⭐ 

```



- 헷갈리는 부분 😥😥😥😥😥😥😥  
``` js 
// 헷갈리는 부분 
	// 1) foo 함수 안에서, x 와 y 는 키워드가 다름 -> so, 함수 레벨 스코프, 블록 레벨 스코프가 다름 -> 그러면, 블록 영향 정도가 달라야 할거 같음 😥😥😥😥😥 
function testFunction() {
    if (true) {
        var functionScoped = 1;  // 함수 레벨 스코프
        let blockScoped = 2;     // 블록 레벨 스코프
    }
    console.log(functionScoped); // 출력됨: 1
    console.log(blockScoped);    // 오류: blockScoped는 정의되지 않음
}
```
- 참고 : [[240110_200010_실행 컨텍스트와 블록레벨 스코프]]
- 참고 : 모던 자바스크립트 p386
- 이게 클로저랑 관련 있는 걸까? 


<br>

### 7) foo 함수 실행 종료 -> 전역 코드 실행 종료 
``` bash 
1. 더 이상 실행할 코드 없음 -> 해당 '스택'에서 'foo 함수 실행 컨텍스트' 'pop' -> 전역 실행 컨텍스트가 실행중인 실행 컨텍스트가 됨
	- 포인트는 , 다시 돌아왔을 때, 실행중인 실행컨텍스트가 된다는 것⭐⭐ 
2. 전역 코드에서, 실행할 것이 없음 -> '스택'에서 '전역 실행 컨텍스트' 'pop'  
```



---

## 추가 학습 
- 23.7 절이 의미하는게 뭔지 아직 파악을 잘 못 함. 
- this 에 대해서 추가 학습 해서 -> 평가에서 넣을 수 있게 해야 함. 
- var, let 의 영향 범위 -> '스코프' 와 관련된 개념 